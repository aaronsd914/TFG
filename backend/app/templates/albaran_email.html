<!doctype html>
<html lang="es">
  <body style="margin:0; padding:0; background:#f6f7fb; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#111;">
    <!-- Preheader (texto que se ve en algunos clientes antes de abrir) -->
    <div style="display:none; max-height:0; overflow:hidden; opacity:0; color:transparent;">
      Tu albarán #{{ albaran.id }} del {{ fecha_humana }}. Total: {{ total_eur }}.
    </div>

    <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="background:#f6f7fb; padding:24px 12px;">
      <tr>
        <td align="center">
          <!-- Contenedor -->
          <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="640" style="max-width:640px; width:100%;">
            <!-- Header -->
            <tr>
              <td style="padding:18px 20px; background:#111827; border-radius:14px 14px 0 0;">
                <div style="color:#fff; font-size:16px; font-weight:700; letter-spacing:0.2px;">
                  {% if tienda_nombre %}{{ tienda_nombre }}{% else %}{{ EMAIL_SENDER_NAME if EMAIL_SENDER_NAME else 'Tienda' }}{% endif %}
                </div>
                <div style="color:#cbd5e1; font-size:12px; margin-top:4px;">
                  Albarán #{{ albaran.id }} · {{ fecha_humana }}
                </div>
              </td>
            </tr>

            <!-- Body -->
            <tr>
              <td style="background:#ffffff; padding:20px; border-left:1px solid #e5e7eb; border-right:1px solid #e5e7eb;">
                <h2 style="margin:0 0 10px; font-size:18px; color:#111827;">Hola {{ cliente.nombre }}{% if cliente.apellidos %} {{ cliente.apellidos }}{% endif %},</h2>

                <p style="margin:0 0 14px; font-size:14px; line-height:1.5; color:#374151;">
                  Gracias por tu compra. Te enviamos adjunto el <strong>albarán #{{ albaran.id }}</strong> correspondiente al día <strong>{{ fecha_humana }}</strong>.
                </p>

                <div style="background:#f9fafb; border:1px solid #e5e7eb; border-radius:12px; padding:12px 14px; margin:0 0 16px;">
                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                    <tr>
                      <td style="font-size:13px; color:#6b7280;">Total</td>
                      <td align="right" style="font-size:16px; font-weight:800; color:#111827;">{{ total_eur }}</td>
                    </tr>
                  </table>
                </div>

                <div style="border:1px solid #e5e7eb; border-radius:12px; overflow:hidden;">
                  <table cellpadding="10" cellspacing="0" border="0" width="100%" style="border-collapse:collapse; font-size:13px;">
                    <thead>
                      <tr style="background:#f3f4f6;">
                        <th align="left" style="color:#374151; font-weight:700;">Producto</th>
                        <th align="right" style="color:#374151; font-weight:700; width:90px;">Cantidad</th>
                        <th align="right" style="color:#374151; font-weight:700; width:110px;">P. unitario</th>
                        <th align="right" style="color:#374151; font-weight:700; width:110px;">Subtotal</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for ln in lineas %}
                      <tr style="border-top:1px solid #eef2f7;">
                        <td style="color:#111827;">{{ ln.producto_nombre }}</td>
                        <td align="right" style="color:#111827;">{{ ln.cantidad }}</td>
                        <td align="right" style="color:#111827;">{{ ln.p_unit_eur }}</td>
                        <td align="right" style="color:#111827;">{{ ln.subtotal_eur }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                    <tfoot>
                      <tr style="background:#fafafa; border-top:1px solid #e5e7eb;">
                        <td colspan="3" align="right" style="color:#374151; font-weight:700;">Total</td>
                        <td align="right" style="color:#111827; font-weight:800;">{{ total_eur }}</td>
                      </tr>
                    </tfoot>
                  </table>
                </div>

                {% if albaran.descripcion %}
                <div style="margin-top:14px; padding:12px 14px; background:#fff7ed; border:1px solid #fed7aa; border-radius:12px;">
                  <div style="font-size:12px; color:#9a3412; font-weight:700; margin-bottom:6px;">Observaciones</div>
                  <div style="font-size:13px; color:#7c2d12; line-height:1.5;">{{ albaran.descripcion }}</div>
                </div>
                {% endif %}

                <p style="margin:16px 0 0; font-size:13px; line-height:1.5; color:#374151;">
                  Si tienes cualquier duda, puedes responder a este correo.
                </p>
              </td>
            </tr>

            <!-- Footer -->
            <tr>
              <td style="background:#ffffff; padding:14px 20px; border:1px solid #e5e7eb; border-top:0; border-radius:0 0 14px 14px;">
                <div style="font-size:12px; color:#6b7280; line-height:1.4;">
                  <div style="font-weight:700; color:#111827; margin-bottom:6px;">
                    {% if tienda_nombre %}{{ tienda_nombre }}{% else %}Gracias por tu compra{% endif %}
                  </div>
                  {% if tienda_direccion %}<div>{{ tienda_direccion }}</div>{% endif %}
                  {% if tienda_telefono %}<div>Tel: {{ tienda_telefono }}</div>{% endif %}
                  {% if tienda_email %}<div>Email: {{ tienda_email }}</div>{% endif %}
                  <div style="margin-top:10px; color:#9ca3af;">
                    Este mensaje ha sido generado automáticamente. Por favor, conserva el albarán adjunto para tus registros.
                  </div>
                </div>
              </td>
            </tr>

          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
